# 儿童故事生成器

## 功能概述
- 生成适合儿童阅读的睡前故事
- 支持单元剧（独立故事）和连续剧（28章长篇故事）两种类型
- 自动计算孩子月龄，根据年龄调整故事内容和长度
- 智能故事概要生成和选择系统
- 支持文本转语音功能，生成有声故事
- 保存连续剧进度，支持继续上次的故事或重新生成
- 基于 Azure OpenAI 的智能故事生成

## 主要特性

### 年龄自适应
- 自动记录孩子信息（年龄、性别）
- 根据月龄智能调整故事复杂度：
  - 0-36个月：简单词汇，重复句式，400-600字
  - 37-60个月：基础情节，角色互动，600-1000字
  - 60个月以上：复杂情节，完整结构，1000-1500字

### 故事生成系统
- **故事概要生成**：AI生成3个不同方向的故事概要供选择
- **场景选择**：森林、城堡、海洋、玩具世界、牧场、太空
- **角色定制**：根据场景推荐合适的主角类型
- **元素融合**：支持自定义故事元素（友谊、勇气、音乐等）

### 连续剧功能
- 28章完整故事架构
- 智能故事连贯性管理
- 支持继续、重新生成、查看完整内容
- 自动保存进度和故事信息

### 语音合成
- 集成 Microsoft Edge TTS
- 支持中文女声朗读
- 自动生成MP3音频文件
- 可选择是否生成语音版本

## 环境要求

### 必需环境变量
```bash
AZURE_OPENAI_API_KEY=your_api_key
AZURE_OPENAI_ENDPOINT=your_endpoint
AZURE_OPENAI_DEPLOYMENT_NAME=your_deployment_name
AZURE_OPENAI_API_VERSION=your_api_version
```

### Python 依赖
```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 环境配置
```bash
# 创建虚拟环境（推荐）
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# 或 .venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt
```

### 2. 运行程序
```bash
python main.py
```

### 3. 使用流程
1. **首次使用**：输入孩子年龄（如：3岁6个月）和性别
2. **故事类型选择**：单元剧或连续剧
3. **场景选择**：从6个预设场景中选择
4. **角色设定**：输入主角类型和名字
5. **故事元素**：添加故事主题元素
6. **概要选择**：从AI生成的3个概要中选择
7. **故事生成**：等待AI生成完整故事
8. **语音合成**：选择是否生成语音版本

## 文件结构
```
Bedtime_Story/
├── main.py              # 主程序
├── requirements.txt     # 依赖列表
├── README.md           # 说明文档
├── child_info.json     # 孩子信息记录（自动生成）
├── serial_story.json   # 连续剧进度记录（自动生成）
└── story_*.mp3         # 生成的语音文件
```

## 高级功能

### 信息重置
- 输入 'r' 可以重置孩子信息
- 支持重新输入年龄和性别

### 连续剧管理
- 自动检测相同场景的连续剧
- 支持继续、重新开始、查看完整内容
- 28章完成后可选择重新阅读或开始新故事

### 错误处理
- 网络连接重试机制
- API错误友好提示
- 输入格式验证

## 注意事项
- 确保网络连接正常
- 检查 Azure OpenAI API 配置是否正确
- 语音文件会保存在程序运行目录
- 连续剧进度会自动保存，无需手动管理

## 技术架构
- **AI引擎**：Azure OpenAI GPT 模型
- **语音合成**：Microsoft Edge TTS
- **数据存储**：JSON 格式本地存储
- **异步处理**：支持语音合成的异步操作

## 更新日志
- 支持28章连续剧（原20章）
- 新增故事概要选择功能
- 集成语音合成功能
- 优化年龄自适应算法
- 增强错误处理和重试机制 
